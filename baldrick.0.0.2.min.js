/* BaldrickJS  V0.0.2 | (C) David Cramer - 2013 | MIT License */
var bindClass="trigger",actionQueued,requestURL=null,_cache={},baldrick=function(a){return new baldrick.fn.buildTriggers(a)};baldrick.fn=baldrick.prototype={buildTriggers:function(e){var f=false;if(document.getElementsByClassName(e)){f=document.getElementsByClassName(e)}var d=[];for(i=0;i<f.length;i++){f[i].delay=0;var c=(f[i].nodeName=="FORM"?"submit":"click");if(!f[i].id){f[i].id="tr"+Math.floor((Math.random()*110)*(Math.random()*110))}for(var b in f[i].attributes){if(f[i].attributes[b]){switch(f[i].attributes[b].name){case"data-init":if(typeof window[f[i].attributes[b].value]=="function"){window[f[i].attributes[b].value](f[i])}f[i].removeAttribute("data-init");break;case"data-delay":f[i].delay=f[i].attributes[b].value;break;case"data-autoload":case"data-preload":if(f[i].attributes[b].value=="true"){f[i].removeAttribute("data-autoload");if(f[i].attributes[b].name=="data-preload"){f[i].removeAttribute("data-preload");_cache[f[i].id]={html:null,}}var a=(f[i].getAttribute("data-delay")?f[i].getAttribute("data-delay"):0);setTimeout(function(){baldrick.fn.doAction(arguments[0])},a,f[i])}break;case"data-event":c=f[i].attributes[b].value;break;default:break}}}if(f[i].addEventListener){f[i].addEventListener(c,baldrick.fn.queueEvent,false)}else{if(f[i].attachEvent){f[i].attachEvent("on"+c,baldrick.fn.queueEvent)}}}window.addEventListener("hashchange",baldrick.fn.hashAction,false)},queueEvent:function(b){b.preventDefault();var a=this;if(a.getAttribute("data-for")){a=(document.getElementById(a.getAttribute("data-for"))?document.getElementById(a.getAttribute("data-for")):a)}clearTimeout(actionQueued);actionQueued=setTimeout(function(){baldrick.fn.buildHash(a);baldrick.fn.doAction(a,b)},a.delay)},doAction:function(d,h){if(!d){baldrick.fn.log("Invalid trigger element");return}window.removeEventListener("hashchange",baldrick.fn.hashAction);if(d.getAttribute("data-clear")){var f=d.getAttribute("data-clear").split(";");f.forEach(function(k){if(document.getElementById(k)){document.getElementById(k).innerHTML=""}})}var e=(d.getAttribute("data-target")?document.getElementById(d.getAttribute("data-target")):null);if(e){if(e.xmlhttp){e.xmlhttp.abort()}else{if(_cache[d.id]!==undefined){if(_cache[d.id].xmlhttp){_cache[d.id].xmlhttp.abort();console.log(_cache[d.id].xmlhttp)}}}}var b={request:(d.getAttribute("data-request")?d.getAttribute("data-request"):null),hrefaction:(d.href?d.href:(d.nodeName=="FORM"?(d.getAttribute("action")?d.getAttribute("action"):requestURL):requestURL)),callback:(d.getAttribute("data-callback")?d.getAttribute("data-callback"):null),before:(d.getAttribute("data-before")?d.getAttribute("data-before"):null),success:(d.getAttribute("data-success")?d.getAttribute("data-success"):null),fail:(d.getAttribute("data-fail")?d.getAttribute("data-fail"):null),activeClass:(d.getAttribute("data-active-class")?d.getAttribute("data-active-class"):"active"),method:(d.getAttribute("data-method")?d.getAttribute("data-method"):(d.nodeName=="FORM"?(d.getAttribute("method")?d.getAttribute("method"):"POST"):"POST")),groups:document.getElementsByClassName(bindClass),target:e,progress:(d.getAttribute("data-progress")?d.getAttribute("data-progress"):null)};if(typeof window[b.before]=="function"){if(window[b.before](h)==false){return}}if(b.groups){for(i=0;i<b.groups.length;i++){if(b.groups[i].getAttribute("data-group")===d.getAttribute("data-group")){b.groups[i].className=b.groups[i].className.replace(" "+b.activeClass,"")}}d.className=d.className+" "+b.activeClass}var j=(d.value?d.value:false);if(window.FileReader&&b.method=="POST"){var c=(d.nodeName=="FORM"?new FormData(d):new FormData());if(j!=false){c.append("value",j)}}else{var c=(d.nodeName=="FORM"?d:new FormData());if(j!=false){c.value=j}}for(var g in d.attributes){if(d.attributes[g]){if(d.attributes[g].name){if(d.attributes[g].name.substr(0,5)=="data-"){if(window.FileReader&&b.method=="POST"){c.append(d.attributes[g].name.substr(5),d.attributes[g].value)}else{c[d.attributes[g].name.substr(5)]=d.attributes[g].value}}}}}if(!e&&!b.callback&&!b.progress){baldrick.fn.log("Invalid target or no target defined. set either data-target or data-calback",d,h)}if((b.request||b.hrefaction)&&(e||typeof window[b.callback]=="function"||b.progress)){try{baldrick.fn.doRequest(b,{element:d,success:function(k){if(typeof window[b.success]=="function"){window[b.success](d,k)}baldrick.fn.buildTriggers(bindClass)},fail:function(k){if(typeof window[b.fail]=="function"){window[b.fail](d,k)}baldrick.fn.buildTriggers(bindClass)},data:c})}catch(a){baldrick.fn.log(a)}}else{baldrick.fn.log("No request URL defined");if(typeof window[b.callback]=="function"){window[b.callback](d,h)}}},doRequest:function(){var d;var h=arguments[1].element;var e=(arguments[0].request?arguments[0].request:arguments[0].hrefaction);var m=(h.getAttribute("data-timeout")?h.getAttribute("data-timeout"):"30000");var j=arguments[0].target;var l=(h.getAttribute("data-load-element")?document.getElementById(h.getAttribute("data-load-element")):j);var a=arguments[0].progress;if(a){if(typeof window[a]!="function"){if(document.getElementById(a)){a=document.getElementById(a)}}}if(l){var c=(h.getAttribute("data-load-class")?h.getAttribute("data-load-class"):"loading");var g=l.className.replace(" "+c,"");l.className=g+" "+c}var o=arguments[1].success;var f=arguments[1].fail;if(typeof window[arguments[0].callback]=="function"){var n=arguments[0].callback;var p=(h.getAttribute("data-callback-type")?h.getAttribute("data-callback-type"):"html")}if(_cache[h.id]!==undefined){if(_cache[h.id].html){if(j){j.innerHTML=_cache[h.id].html;l.className=g}if(n){var k=document.createElement("script");k.setAttribute("type","text/javascript");if(p=="html"||p=="HTML"){window[n](_cache[h.id].html)}else{k.text=n+"("+_cache[h.id].html+");";document.head.appendChild(k);document.head.removeChild(document.head.lastChild)}}o(_cache[h.id]);_cache[h.id].html=null}}serialize=function(r){var s=[];for(var q in r){s.push(encodeURIComponent(q)+"="+encodeURIComponent(r[q]))}return s.join("&")};e=(arguments[0].method=="GET"?e+"?"+serialize(arguments[1].data):e);if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLHTTP")}else{return false}}if(_cache[h.id]!==undefined){_cache[h.id].xmlhttp=d}else{if(j){j.xmlhttp=d}}if(m>0){var b=setTimeout(function(){if(m>0){d.abort();baldrick.fn.log("Timeout ("+m+"ms)")}},m)}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){clearTimeout(b);if(a){if(typeof window[a]=="function"){window[a]({response:d.responseText,completed:100})}else{a.style.width="100%"}}if(l){l.className=g}if(j&&_cache[h.id]!==undefined){if(_cache[h.id].html==null){_cache[h.id].html=d.responseText;delete _cache[h.id].xmlhttp}else{j.innerHTML=d.responseText;delete j.xmlhttp}}else{if(j){j.innerHTML=d.responseText;delete j.xmlhttp}if(n){var q=document.createElement("script");q.setAttribute("type","text/javascript");if(p=="html"||p=="HTML"){window[n](d.responseText)}else{if(JSON){window[n](JSON.parse(d.responseText))}else{q.text=n+"("+d.responseText+");";document.head.appendChild(q);document.head.removeChild(document.head.lastChild)}}}o(d)}}if(d.readyState==4&&d.status==307){clearTimeout(b);baldrick.fn.log("HTTP Status: 307");document.location="./"}if(d.readyState==4&&d.status!=200&&d.status!=307){if(l){l.className=g}clearTimeout(b);if(d.status){baldrick.fn.log("HTTP Status: "+d.status)}if(j){delete j.xmlhttp}if(f){f(d);baldrick.fn.log("Request failed")}if(a){if(typeof window[a]=="function"){window[a]({response:d.responseText,completed:0})}else{a.style.width="0%"}}}};d.open(arguments[0].method,e,true);if(p=="json"||p=="JSON"){d.setRequestHeader("Accept","application/json,text/javascript")}if(arguments[0].method=="POST"){if(!window.FileReader){d.setRequestHeader("Content-type","application/x-www-form-urlencoded")}else{if(d.upload&&a){d.upload.onprogress=function(q){if(q.lengthComputable){if(typeof window[a]=="function"){window[a]({loaded:q.loaded,total:q.totalSize,completed:(q.loaded/q.totalSize*100)})}else{a.style.width=(q.loaded/q.totalSize*100)+"%"}}}}}}else{if(typeof window[arguments[0].callback]=="function"){}d.open(arguments[0].method,e,true);d.setRequestHeader("Content-type","application/x-www-form-urlencoded")}if(arguments[1].data){if(!window.FileReader){arguments[1].data=serialize(arguments[1].data)}d.send(arguments[1].data)}else{d.send()}},hashAction:function(a){var b=window.location.hash.substring(2);element=document.getElementById(b);if(element){baldrick.fn.doAction(element,a)}},buildHash:function(a){if(!a){return}window.location="#!"+a.id},formObject:function(c){if(!c||c.nodeName!=="FORM"){return}var b,a,d=new Object;for(b=c.elements.length-1;b>=0;b=b-1){if(c.elements[b].name===""){continue}switch(c.elements[b].nodeName){case"INPUT":switch(c.elements[b].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":case"TEXTAREA":d[c.elements[b].name]=c.elements[b].value;break;case"checkbox":case"radio":if(c.elements[b].checked){d[c.elements[b].name]=c.elements[b].value}break;case"file":baldrick.fn.log("Browser does not support file uploads file API");break}break;case"SELECT":switch(c.elements[b].type){case"select-one":d[c.elements[b].name]=c.elements[b].value;break;case"select-multiple":for(a=c.elements[b].options.length-1;a>=0;a=a-1){if(c.elements[b].options[a].selected){d[c.elements[b].name][a]=c.elements[b].options[a].value}}break}break;case"BUTTON":switch(c.elements[b].type){case"reset":case"submit":case"button":d[c.elements[b].name]=c.elements[b].value;break}break}}return d},log:function(){}};var readyStateCheckInterval=setInterval(function(){if(document.readyState==="complete"){baldrick(bindClass);clearInterval(readyStateCheckInterval)}},10);