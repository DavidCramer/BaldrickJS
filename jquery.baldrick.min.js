/* BaldrickJS  V2.1 | (C) David Cramer - 2013 | MIT License */
!function(a){var b={},c={_plugins:{},bind:{},event:function(a){return a},filter:function(a){return a},target:function(a){if(a.params.target)if(a.params.target[a.params.targetInsert](a.data),"string"==typeof a.params.callback){if("function"==typeof window[a.params.callback])return window[a.params.callback](a)}else if("function"==typeof a.params.callback)return a.params.callback(a)},request:function(c){return c.request.url.indexOf("#_cache_")>-1&&"object"==typeof b[c.request.url.split("#_cache_")[1]]?{data:b[c.request.url.split("#_cache_")[1]]}:a.ajax(c.request)},xhr:function(b,c,d){if(d.trigger.data("progress")&&a(d.trigger.data("progress")).length>0){var e=a(d.trigger.data("progress"));e.width(0),b.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;e.width(100*b+"%")}},!1),b.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;e.width(100*b+"%")}},!1)}return b},request_complete:function(a){a.params.complete(a),a.params.loadElement.removeClass(a.params.loadClass)},request_error:function(a){a.params.complete(a.jqxhr,a.textStatus)},refresh:function(b,c){a(c.triggerClass).baldrick(c)}};a.fn.baldrick=function(b){var d=this.selector,e=this.not("._tisBound");e.addClass("_tisBound"),"undefined"!=typeof b&&"object"==typeof b.helper&&(c._plugins._params_helpers_=b.helper);var f=a.extend(!0,b,{helpers:c},{triggerClass:d}),g=function(){return!0},h={before:g,callback:!1,complete:g,error:g};for(var j in h)"string"==typeof f[j]?h[j]="function"==typeof window[f[j]]?window[f[j]]:g:"function"==typeof f[j]&&(h[j]=f[j]);var k=function(a,b,c){var d;for(var e in f.helpers._plugins)if("function"==typeof f.helpers._plugins[e][a]&&(d=f.helpers._plugins[e][a](b,f,c),"undefined"!=typeof d&&(b=d),b===!1))return!1;if("function"==typeof f.helpers[a]&&(d=f.helpers[a](b,f,c),"undefined"!=typeof d&&(b=d),!b))return!1;for(var g in f.helpers._plugins)if("function"==typeof f.helpers._plugins[g]["after_"+a]&&(d=f.helpers._plugins[g]["after_"+a](b,f,c),"undefined"!=typeof d&&(b=d),b===!1))return!1;return b};return e=k("bind",e),e===!1?this:k("ready",e.each(function(b){this.id||(this.id="baldrick_trigger_"+((new Date).getTime()+b));var c=a(this),d=c.data("event")?c.data("event"):f.event?f.event:c.is("form")?"submit":"click";return c.on(d,function(b){var c=a(k("event",this,b));if(c.data("for")){var g=a(c.data("for")),i=a.extend({},g.data(),c.data());return delete i["for"],g.data(i),g.trigger(g.data("event")?g.data("event"):d)}if(c.is("form")&&!c.data("request")&&c.attr("action")&&c.data("request",c.attr("action")),c.is("a")&&!c.data("request")&&c.attr("href")&&(c.attr("href").indexOf("#")<0?c.data("request",c.attr("href")):c.data("href",c.attr("href"))),(c.data("before")?"function"==typeof window[c.data("before")]?window[c.data("before")](this,b):h.before(this,b):h.before(this,b))!==!1){var j={trigger:c,callback:c.data("callback")?"function"==typeof window[c.data("callback")]?window[c.data("callback")]:c.data("callback"):h.callback,method:c.data("method")?c.data("method"):c.attr("method")?c.attr("method"):f.method?f.method:"GET",dataType:c.data("type")?c.data("type"):f.dataType?f.dataType:!1,target:c.data("target")?a(c.data("target")):f.target?a(f.target):a("<html>"),targetInsert:c.data("targetInsert")?"replace"===c.data("targetInsert")?"replaceWith":c.data("targetInsert"):f.targetInsert?"replace"===f.targetInsert?"replaceWith":f.targetInsert:"html",loadClass:c.data("loadClass")?c.data("loadClass"):f.loadClass?f.loadClass:"loading",activeClass:c.data("activeClass")?c.data("activeClass"):f.activeClass?f.activeClass:"active",activeElement:c.data("activeElement")?"_parent"===c.data("activeElement")?c.parent():a(c.data("activeElement")):f.activeElement?"_parent"===f.activeElement?c.parent():a(f.activeElement):c,cache:c.data("cache")?c.data("cache"):f.cache?f.cache:!1,complete:c.data("complete")?"function"==typeof window[c.data("complete")]?window[c.data("complete")]:h.complete:h.complete,contentType:c.data("contentType")?c.data("contentType"):"application/x-www-form-urlencoded; charset=UTF-8",processData:c.data("processData")?c.data("processData"):!0,resultSelector:!1};if(j.url=c.data("request")?c.data("request"):f.request?f.request:j.callback,j.loadElement=c.data("loadElement")?a(c.data("loadElement")):f.loadElement?a(f.loadElement)?a(f.loadElement):j.target:j.target,j=k("params",j),j===!1)return!1;switch(typeof j.url){case"function":return j.url(this,b);case"boolean":case"object":return;case"string":if(j.url.indexOf(" ")>-1){var l=j.url.split(" ");j.url=l[0],j.resultSelector=l[1]}}b.preventDefault(),c.data("group")?a('._tisBound[data-group="'+c.data("group")+'"]').each(function(){var b=a(this),d=b.data("activeElement")?"_parent"===b.data("activeElement")?b.parent():a(b.data("activeElement")):f.activeElement?"_parent"===f.activeElement?c.parent():a(f.activeElement):b;d.removeClass(b.data("activeClass")?b.data("activeClass"):f.activeClass?f.activeClass:j.activeClass)}):a("._tisBound:not([data-group])").each(function(){var b=a(this),d=b.data("activeElement")?"_parent"===b.data("activeElement")?b.parent():a(b.data("activeElement")):f.activeElement?"_parent"===f.activeElement?c.parent():a(f.activeElement):b;d.removeClass(b.data("activeClass")?b.data("activeClass"):f.activeClass?f.activeClass:j.activeClass)}),j.activeElement.addClass(j.activeClass),j.loadElement.addClass(j.loadClass);var n;if(FormData&&(c.is("input:file")||c.is("form")||"POST"===j.method)){c.is("form")?(n=new FormData(c[0]),c.find("input:file").length&&(j.method="POST",j.contentType=!1)):n=new FormData,j.processData=!1,j.cache=!1;for(var o in c.data())n.append("_"+o,c.data(o));if(c.is("input"))if(c.is("input:file")){if(c[0].files.length>1)for(var p=0;p<c[0].files.length;p++)n.append(c.prop("name"),c[0].files[p]);else n.append(c.prop("name"),c[0].files[0]);j.method="POST",j.contentType=!1}else c.is("input:checkbox")||c.is("input:radio")?c.prop("checked")&&n.append(c.prop("name"),c.val()):n.append(c.prop("name"),c.val())}else{var q=c.serializeArray(),r=c.data(),s=[];f.data&&(r=a.extend(f.data,r)),a.each(r,function(a,b){s.push({name:"_"+a,value:b})}),q.length&&a.each(q,function(a,b){s.push(b)}),n=a.param(s)}var t={url:j.url,data:n,cache:j.cache,type:j.method,contentType:j.contentType,processData:j.processData,xhr:function(){var a=new window.XMLHttpRequest;return k("xhr",a,j)},success:function(b){if(j.resultSelector)if("object"==typeof b){for(var e=j.resultSelector.replace(/\[/g,".").replace(/\]/g,"").split("."),f=b,g=0;g<e.length;g++)f=f[e[g]];b=f}else if("string"==typeof b){var h=a(j.resultSelector,a("<html>").html(b));1===h.length?b=a("<html>").html(h).html():(b=a("<html>"),h.each(function(){b.append(this)}),b=b.html())}var i=b;b=k("filter",{data:b,rawData:i,request:t,params:j}),k("target",b)},complete:function(a,b){k("request_complete",{jqxhr:a,textStatus:b,request:t,params:j}),k("refresh",{jqxhr:a,textStatus:b,request:t,params:j}),c.data("once")&&c.off(d).removeClass("_tisBound")},error:function(a,b,c){k("request_error",{jqxhr:a,textStatus:b,error:c,request:t,params:j})}};if(j.dataType&&(t.dataType=j.dataType),t=k("request_params",t,j),t===!1)return e;var u=k("request",{request:t,params:j});if(u.data){var v=u.data,w=v;k("filter",{data:v,rawData:w,request:t,params:j}),k("request_complete",{jqxhr:!1,textStatus:!0,request:t,params:j}),k("refresh",{jqxhr:!1,textStatus:!0,request:t,params:j})}}}),(c.data("autoload")||c.data("poll"))&&(c.data("delay")?setTimeout(function(a,b){return a.trigger(b)},c.data("delay"),c,d):c.trigger(d)),c.data("poll")&&(c.data("delay")?setTimeout(function(a,b){return setInterval(function(a,b){return a.trigger(b)},a.data("poll"),a,b)},c.data("delay")):setInterval(function(a,b){return a.trigger(b)},c.data("poll"),c,d)),this}))},a.fn.baldrick.cacheObject=function(a,c){b[a]=c},a.fn.baldrick.registerhelper=function(b,d,e){var f={};"object"==typeof d?(f[b]=d,c._plugins=a.extend(!0,f,c._plugins)):"string"==typeof d&&"string"==typeof b&&"function"==typeof e&&(f[d]={},f[d][b]=e,c._plugins=a.extend(!0,f,c._plugins))},jQuery(function(a){a(".baldrick").baldrick()})}(jQuery);