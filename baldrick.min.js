/* BaldrickJS  V0.0.2 | (C) David Cramer & Rory McGuire - 2013 | MIT License */
var bindClass="trigger",actionQueued,baldrick=function(a){return new baldrick.fn.bindTriggers(a)};baldrick.fn=baldrick.prototype={bindTriggers:function(a){var b=!1;for(document.getElementsByClassName(a)&&(b=document.getElementsByClassName(a)),i=0;b.length>i;i++){b[i].delay=0;var d="FORM"==b[i].nodeName?"submit":"click";for(var e in b[i].attributes)if(b[i].attributes[e]){var f=b[i].attributes[e].value;switch(b[i].attributes[e].name){case"data-init":"function"==typeof window[f]&&window[f](b[i]),b[i].removeAttribute("data-init");break;case"data-delay":b[i].delay=f;break;case"data-poll":f>0&&(b[i].removeAttribute("data-poll"),setInterval(function(){baldrick.fn.doAction(arguments[0])},f,b[i]));case"data-autoload":if(f){b[i].removeAttribute("data-autoload"),"clean"==f&&b[i].setAttribute("data-once",!0);var g=b[i].getAttribute("data-delay")?b[i].getAttribute("data-delay"):0;setTimeout(function(){baldrick.fn.doAction(arguments[0])},g,b[i])}break;case"data-event":d=f;break;default:}}b[i]._isTrigger||(b[i]._isTrigger=!0,b[i].addEventListener?b[i].addEventListener(d,baldrick.fn.queueEvent,!1):b[i].attachEvent&&b[i].attachEvent("on"+d,baldrick.fn.queueEvent))}window.addEventListener("hashchange",baldrick.fn.hashAction,!1)},queueEvent:function(a){var b=this;b.getAttribute("data-before")&&"function"==typeof window[b.getAttribute("data-before")]&&0==window[b.getAttribute("data-before")](a)||(a.preventDefault(),b.getAttribute("data-for")&&(b=document.getElementById(b.getAttribute("data-for"))?document.getElementById(b.getAttribute("data-for")):b),actionQueued&&clearTimeout(actionQueued),actionQueued=setTimeout(function(){baldrick.fn.buildHash(b),baldrick.fn.doAction(b,a)},b.delay))},doAction:function(a,b){if(!a)return baldrick.fn.log("Invalid trigger element"),void 0;window.removeEventListener("hashchange",baldrick.fn.hashAction);var c=a.getAttribute("data-target")?document.getElementById(a.getAttribute("data-target")):null;if(c)c.xmlhttp&&c.xmlhttp.abort();else if(document.getElementsByClassName(a.getAttribute("data-target").substr(1)).length>0)var c=document.getElementsByClassName(a.getAttribute("data-target").substr(1));var d={request:a.getAttribute("data-request")?a.getAttribute("data-request"):null,hrefaction:a.href?a.href:"FORM"==a.nodeName?a.getAttribute("action")?a.getAttribute("action"):requestURL:null,callback:a.getAttribute("data-callback")?a.getAttribute("data-callback"):a.getAttribute("data-target")?a.getAttribute("data-target"):null,success:a.getAttribute("data-success")?a.getAttribute("data-success"):null,fail:a.getAttribute("data-fail")?a.getAttribute("data-fail"):null,activeClass:a.getAttribute("data-active-class")?a.getAttribute("data-active-class"):"active",method:a.getAttribute("data-method")?a.getAttribute("data-method"):"FORM"==a.nodeName?a.getAttribute("method")?a.getAttribute("method"):"POST":"POST",groups:document.getElementsByClassName(bindClass),target:c,progress:a.getAttribute("data-progress")?a.getAttribute("data-progress"):null};if(!a.getAttribute("data-start")||"function"!=typeof window[a.getAttribute("data-start")]||0!=window[a.getAttribute("data-start")](b)){if(d.groups){for(i=0;d.groups.length>i;i++)d.groups[i].getAttribute("data-group")===a.getAttribute("data-group")&&(d.groups[i].className=d.groups[i].className.replace(" "+d.activeClass,""));a.className=a.className+" "+d.activeClass}var e=a.value?a.value:!1;if(window.FileReader&&"POST"==d.method){var f="FORM"==a.nodeName?new FormData(a):new FormData;0!=e&&f.append("value",e)}else{var f="FORM"==a.nodeName?a:new FormData;0!=e&&(f.value=e)}for(var g in a.attributes)a.attributes[g]&&a.attributes[g].name&&"data-"==a.attributes[g].name.substr(0,5)&&(window.FileReader&&"POST"==d.method?f.append(a.attributes[g].name.substr(5),a.attributes[g].value):f[a.attributes[g].name.substr(5)]=a.attributes[g].value);if(c||d.callback||d.progress||baldrick.fn.log("Invalid target or no target defined. set either data-target or data-calback",a,b),(d.request||d.hrefaction)&&(c||"function"==typeof window[d.callback]||d.progress))try{baldrick.fn.doRequest(d,{element:a,success:function(b){"function"==typeof window[d.success]&&window[d.success](a,b),a.getAttribute("data-once")&&a.parentNode.removeChild(a),baldrick.fn.bindTriggers(bindClass)},fail:function(b){"function"==typeof window[d.fail]&&window[d.fail](a,b),baldrick.fn.bindTriggers(bindClass)},data:f})}catch(h){baldrick.fn.log(h)}else baldrick.fn.log("No request URL defined"),"function"==typeof window[d.callback]&&(window[d.callback](a,b),baldrick.fn.bindTriggers(bindClass))}},doRequest:function(){var a,b=arguments[1].element,c=arguments[0].request?arguments[0].request:arguments[0].hrefaction,d=b.getAttribute("data-timeout")?b.getAttribute("data-timeout"):"30000",e=arguments[0].target,f=b.getAttribute("data-load-element")?document.getElementById(b.getAttribute("data-load-element")):e,g=arguments[0].progress;if(g&&"function"!=typeof window[g]&&document.getElementById(g)&&(g=document.getElementById(g)),f){var h=b.getAttribute("data-load-class")?b.getAttribute("data-load-class"):"loading";if(f.length){var j=[];for(i=0;f.length>i;i++)j.push(f[i].className.replace(" "+h,"")),f[i].className=j[i]+" "+h}else{var j=f.className.replace(" "+h,"");f.className=j+" "+h}}var k=arguments[1].success,l=arguments[1].fail;if("function"==typeof window[arguments[0].callback])var m=arguments[0].callback,n=b.getAttribute("data-callback-type")?b.getAttribute("data-callback-type"):"html";if(serialize=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},c="GET"==arguments[0].method?c+"?"+serialize(arguments[1].data):c,window.XMLHttpRequest)a=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;a=new ActiveXObject("Microsoft.XMLHTTP")}if(e)if(e.length)for(i=0;e.length>i;i++)e[i].xmlhttp=a;else e.xmlhttp=a;if(d>0)var o=setTimeout(function(){d>0&&(a.abort(),baldrick.fn.log("Timeout ("+d+"ms)"))},d);if(a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){if(clearTimeout(o),g&&("function"==typeof window[g]?window[g]({response:a.responseText,completed:100}):g.style.width="100%"),f)if(f.length)for(i=0;f.length>i;i++)f[i].className=j[i];else f.className=j;if(e)if(b.getAttribute("data-target-insert"))switch(b.getAttribute("data-target-insert")){case"append":case"after":if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=e[i].innerHTML+a.responseText;else e.innerHTML=e.innerHTML+a.responseText;break;case"prepend":case"before":if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=a.responseText+e[i].innerHTML;else e.innerHTML=a.responseText+e.innerHTML;break;default:if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=a.responseText;else e.innerHTML=a.responseText}else if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=a.responseText,delete e[i].xmlhttp;else e.innerHTML=a.responseText,delete e.xmlhttp;if(m){var c=document.createElement("script");c.setAttribute("type","text/javascript"),"html"==n||"HTML"==n?window[m](a.responseText,b):JSON?window[m](JSON.parse(a.responseText),b):(c.text=m+"("+a.responseText+");",document.head.appendChild(c),document.head.removeChild(document.head.lastChild))}k(a)}4==a.readyState&&307==a.status&&(clearTimeout(o),baldrick.fn.log("HTTP Status: 307"),document.location="./"),4==a.readyState&&200!=a.status&&307!=a.status&&(f&&(f.className=j),clearTimeout(o),a.status&&baldrick.fn.log("HTTP Status: "+a.status),e&&delete e.xmlhttp,l&&(l(a),baldrick.fn.log("Request failed")),g&&("function"==typeof window[g]?window[g]({response:a.responseText,completed:0}):g.style.width="0%"))},a.open(arguments[0].method,c,!0),("json"==n||"JSON"==n)&&a.setRequestHeader("Accept","application/json,text/javascript"),"POST"==arguments[0].method?window.FileReader?a.upload&&g&&(a.upload.onprogress=function(a){a.lengthComputable&&("function"==typeof window[g]?window[g]({loaded:a.loaded,total:a.totalSize,completed:100*(a.loaded/a.totalSize)}):g.style.width=100*(a.loaded/a.totalSize)+"%")}):a.setRequestHeader("Content-type","application/x-www-form-urlencoded"):("function"==typeof window[arguments[0].callback],a.open(arguments[0].method,c,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded")),arguments[1].data?(window.FileReader||(arguments[1].data=serialize(arguments[1].data)),a.send(arguments[1].data)):a.send(),arguments[1].element.getAttribute("data-clear")){var p=arguments[1].element.getAttribute("data-clear").split(";");p.forEach(function(a){document.getElementById(a)&&("INPUT"==document.getElementById(a).nodeName?document.getElementById(a).value=null:document.getElementById(a).innerHTML=null)})}},hashAction:function(){window.location.hash||(document.location=document.location);var b=window.location.hash.substring(2),c=b.split("&");if("_tr"==c[0]){for(i=1;c.length>i;i++){var d=c[i].split("=");if(1==d.length)var e=document.createElement(d[0]);else"href"==d[0]?e.setAttribute(d[0],d[1]):e.setAttribute("data-"+d[0],d[1])}if(e)return baldrick.fn.doAction(e),delete e,void 0}},buildHash:function(a){if(a&&"FORM"!=a.nodeName){for(var b=[a.nodeName.toLowerCase()],c=0;a.attributes.length>c;c++)if(name=a.attributes[c].name,"href"==name||"data-request"==name)var d=encodeURIComponent(a.attributes[c].name.replace("data-",""))+"="+encodeURIComponent(a.attributes[c].value);else 0==name.indexOf("data-")&&b.push(encodeURIComponent(a.attributes[c].name.slice(5))+"="+encodeURIComponent(a.attributes[c].value));window.location="#!_tr&"+b.join("&")+"&"+d}},formObject:function(a){if(a&&"FORM"===a.nodeName){var b,c,d=Object();for(b=a.elements.length-1;b>=0;b-=1)if(""!==a.elements[b].name)switch(a.elements[b].nodeName){case"INPUT":switch(a.elements[b].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":case"TEXTAREA":d[a.elements[b].name]=a.elements[b].value;break;case"checkbox":case"radio":a.elements[b].checked&&(d[a.elements[b].name]=a.elements[b].value);break;case"file":baldrick.fn.log("Browser does not support file uploads file API")}break;case"SELECT":switch(a.elements[b].type){case"select-one":d[a.elements[b].name]=a.elements[b].value;break;case"select-multiple":for(c=a.elements[b].options.length-1;c>=0;c-=1)a.elements[b].options[c].selected&&(d[a.elements[b].name][c]=a.elements[b].options[c].value)}break;case"BUTTON":switch(a.elements[b].type){case"reset":case"submit":case"button":d[a.elements[b].name]=a.elements[b].value}}return d}},defaults:{},log:function(){}};var readyStateCheckInterval=setInterval(function(){"complete"===document.readyState&&(baldrick(bindClass),clearInterval(readyStateCheckInterval))},10);