/* BaldrickJS  V0.0.2 | (C) David Cramer & Rory McGuire - 2013 | MIT License */
var bindClass="trigger",actionQueued,baldrick=function(a){return new baldrick.fn.bindTriggers(a)};baldrick.fn=baldrick.prototype={bindTriggers:function(a){var b=!1;for(document.getElementsByClassName(a)&&(b=document.getElementsByClassName(a)),i=0;b.length>i;i++){b[i].delay=0;var d="FORM"==b[i].nodeName?"submit":"click",e=!0;for(var f in b[i].attributes)if(b[i].attributes[f]){var g=b[i].attributes[f].value;switch(b[i].attributes[f].name){case"data-init":"function"==typeof window[g]&&window[g](b[i]),b[i].removeAttribute("data-init");break;case"data-delay":b[i].delay=g;break;case"data-poll":g>0&&(b[i].removeAttribute("data-poll"),setInterval(function(){baldrick.fn.doAction(arguments[0])},g,b[i]));case"data-autoload":if(g){b[i].removeAttribute("data-autoload"),"clean"==g&&b[i].setAttribute("data-once",!0);var h=b[i].getAttribute("data-delay")?b[i].getAttribute("data-delay"):0;setTimeout(function(){baldrick.fn.doAction(arguments[0])},h,b[i])}break;case"data-event":d=g;break;case"data-history":"off"==g&&(e=!1);break;default:}}b[i]._isTrigger||(b[i]._isTrigger=!0,b[i].addEventListener?b[i].addEventListener(d,baldrick.fn.queueEvent,!1):b[i].attachEvent&&b[i].attachEvent("on"+d,baldrick.fn.queueEvent))}e&&window.addEventListener("hashchange",baldrick.fn.hashAction,!1)},queueEvent:function(a){var b=this;b.getAttribute("data-before")&&"function"==typeof window[b.getAttribute("data-before")]&&0==window[b.getAttribute("data-before")](a)||(a.preventDefault(),b.getAttribute("data-for")&&(b=document.getElementById(b.getAttribute("data-for"))?document.getElementById(b.getAttribute("data-for")):b),actionQueued&&clearTimeout(actionQueued),actionQueued=setTimeout(function(){baldrick.fn.buildHash(b),baldrick.fn.doAction(b,a)},b.delay))},doAction:function(a,b){if(!a)return baldrick.fn.log("Invalid trigger element"),void 0;window.removeEventListener("hashchange",baldrick.fn.hashAction);var c=a.getAttribute("data-target")?document.getElementById(a.getAttribute("data-target")):null;if(c)c.xmlhttp&&c.xmlhttp.abort();else if(a.getAttribute("data-target")&&document.getElementsByClassName(a.getAttribute("data-target").substr(1)))var c=document.getElementsByClassName(a.getAttribute("data-target").substr(1));var d={request:a.getAttribute("data-request")?a.getAttribute("data-request"):null,hrefaction:a.href?a.href:"FORM"==a.nodeName?a.getAttribute("action")?a.getAttribute("action"):requestURL:null,callback:a.getAttribute("data-callback")?a.getAttribute("data-callback"):a.getAttribute("data-target")?a.getAttribute("data-target"):null,success:a.getAttribute("data-success")?a.getAttribute("data-success"):null,fail:a.getAttribute("data-fail")?a.getAttribute("data-fail"):null,activeClass:a.getAttribute("data-active-class")?a.getAttribute("data-active-class"):"active",method:a.getAttribute("data-method")?a.getAttribute("data-method").toUpperCase():"FORM"==a.nodeName?a.getAttribute("method").toUpperCase()?a.getAttribute("method").toUpperCase():"GET":"GET",groups:document.getElementsByClassName(bindClass),target:c,progress:a.getAttribute("data-progress")?a.getAttribute("data-progress"):null};if(!a.getAttribute("data-start")||"function"!=typeof window[a.getAttribute("data-start")]||0!=window[a.getAttribute("data-start")](b)){if(d.groups){for(i=0;d.groups.length>i;i++)d.groups[i].getAttribute("data-group")===a.getAttribute("data-group")&&(d.groups[i].className=d.groups[i].className.replace(" "+d.activeClass,""));a.className=a.className+" "+d.activeClass}var e=a.value?a.value:!1;if(window.FileReader&&"POST"==d.method){var f="FORM"==a.nodeName?new FormData(a):new FormData;0!=e&&f.append("value",e)}else{var f="FORM"==a.nodeName?a:new FormData;0!=e&&(f.value=e)}for(var g in a.attributes)a.attributes[g]&&a.attributes[g].name&&"data-"==a.attributes[g].name.substr(0,5)&&(window.FileReader&&"POST"==d.method?f.append(a.attributes[g].name.substr(5),a.attributes[g].value):f[a.attributes[g].name.substr(5)]=a.attributes[g].value);if(c||d.callback||d.progress||baldrick.fn.log("Invalid target or no target defined. set either data-target or data-calback",a,b),(d.request||d.hrefaction)&&(c||"function"==typeof window[d.callback]||d.progress))try{baldrick.fn.doRequest(d,{element:a,success:function(b){"function"==typeof window[d.success]&&window[d.success](a,b),a.getAttribute("data-once")&&a.parentNode.removeChild(a),baldrick.fn.bindTriggers(bindClass)},fail:function(b){"function"==typeof window[d.fail]&&window[d.fail](a,b),baldrick.fn.bindTriggers(bindClass)},data:f})}catch(h){baldrick.fn.log(h)}else if(baldrick.fn.log("No request URL defined"),"function"==typeof window[d.callback]&&(window[d.callback](a,b),baldrick.fn.bindTriggers(bindClass)),a.getAttribute("data-clear")){var j=a.getAttribute("data-clear").split(";");j.forEach(function(a){document.getElementById(a)&&("INPUT"==document.getElementById(a).nodeName?document.getElementById(a).value=null:document.getElementById(a).innerHTML="")})}}},doRequest:function(){var a,b=arguments[1].element,c=arguments[0].request?arguments[0].request:arguments[0].hrefaction,d=b.getAttribute("data-timeout")?b.getAttribute("data-timeout"):"30000",e=arguments[0].target,f=b.getAttribute("data-load-element")?document.getElementById(b.getAttribute("data-load-element")):e,g=b.getAttribute("data-load-text")?b.getAttribute("data-load-text"):null,h=arguments[0].progress;if(h&&"function"!=typeof window[h]&&document.getElementById(h)&&(h=document.getElementById(h)),f){if(g){var j="";f.innerHTML&&(j=f.innerHTML),f.innerHTML=g}var k=b.getAttribute("data-load-class")?b.getAttribute("data-load-class"):"loading";if(f.length){var l=[];for(i=0;f.length>i;i++)l.push(f[i].className.replace(" "+k,"")),f[i].className=l[i]+" "+k}else{var l=f.className.replace(" "+k,"");f.className=l+" "+k}}var m=arguments[1].success,n=arguments[1].fail;if("function"==typeof window[arguments[0].callback])var o=arguments[0].callback,p=b.getAttribute("data-callback-type")?b.getAttribute("data-callback-type"):"html";if(serialize=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},c="GET"==arguments[0].method?c+"?"+serialize(arguments[1].data):c,window.XMLHttpRequest)a=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;a=new ActiveXObject("Microsoft.XMLHTTP")}if(e)if(e.length)for(i=0;e.length>i;i++)e[i].xmlhttp=a;else e.xmlhttp=a;if(d>0)var q=setTimeout(function(){d>0&&(a.abort(),baldrick.fn.log("Timeout ("+d+"ms)"))},d);if(a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){if(clearTimeout(q),h&&("function"==typeof window[h]?window[h]({response:a.responseText,completed:100}):h.style.width="100%"),f)if(f.length)for(i=0;f.length>i;i++)f[i].className=l[i];else f.className=l;if(e)if(b.getAttribute("data-target-insert"))switch(b.getAttribute("data-target-insert")){case"append":case"after":if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=e[i].innerHTML+a.responseText;else e.innerHTML=e.innerHTML+a.responseText;break;case"prepend":case"before":if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=a.responseText+e[i].innerHTML;else e.innerHTML=a.responseText+e.innerHTML;break;default:if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=a.responseText;else e.innerHTML=a.responseText}else if(e.length)for(i=0;f.length>i;i++)e[i].innerHTML=a.responseText,delete e[i].xmlhttp;else e.innerHTML=a.responseText,delete e.xmlhttp;if(o){var c=document.createElement("script");c.setAttribute("type","text/javascript"),"html"==p||"HTML"==p?window[o](a.responseText,b):JSON?window[o](JSON.parse(a.responseText),b):(c.text=o+"("+a.responseText+");",document.head.appendChild(c),document.head.removeChild(document.head.lastChild))}m(a)}4==a.readyState&&307==a.status&&(clearTimeout(q),baldrick.fn.log("HTTP Status: 307"),document.location="./"),4==a.readyState&&200!=a.status&&307!=a.status&&(f&&(f.className=l),f.innerHTML=j,clearTimeout(q),a.status&&baldrick.fn.log("HTTP Status: "+a.status),e&&delete e.xmlhttp,n&&(n(a),baldrick.fn.log("Request failed")),h&&("function"==typeof window[h]?window[h]({response:a.responseText,completed:0}):h.style.width="0%"))},a.open(arguments[0].method,c,!0),("json"==p||"JSON"==p)&&a.setRequestHeader("Accept","application/json,text/javascript"),"POST"==arguments[0].method?window.FileReader?a.upload&&h&&(a.upload.onprogress=function(a){a.lengthComputable&&("function"==typeof window[h]?window[h]({loaded:a.loaded,total:a.totalSize,completed:100*(a.loaded/a.totalSize)}):h.style.width=100*(a.loaded/a.totalSize)+"%")}):a.setRequestHeader("Content-type","application/x-www-form-urlencoded"):("function"==typeof window[arguments[0].callback],a.open(arguments[0].method,c,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded")),arguments[1].data?(window.FileReader||(arguments[1].data=serialize(arguments[1].data)),a.send(arguments[1].data)):a.send(),arguments[1].element.getAttribute("data-clear")){var r=arguments[1].element.getAttribute("data-clear").split(";");r.forEach(function(a){document.getElementById(a)&&("INPUT"==document.getElementById(a).nodeName?document.getElementById(a).value=null:document.getElementById(a).innerHTML="")})}},hashAction:function(){window.location.hash||(document.location=document.location);var b=window.location.hash.substring(2),c=b.split("&");if("_tr"==c[0]){for(i=1;c.length>i;i++){var d=c[i].split("=");if(1==d.length)var e=document.createElement(d[0]);else"href"==d[0]?e.setAttribute(d[0],d[1]):e.setAttribute("data-"+d[0],d[1])}if(e)return baldrick.fn.doAction(e),delete e,void 0}},buildHash:function(a){if(a&&(!a.getAttribute("data-history")||"off"!=a.getAttribute("data-history"))&&"FORM"!=a.nodeName&&"INPUT"!=a.nodeName){for(var b=[a.nodeName.toLowerCase()],c=0;a.attributes.length>c;c++)if(name=a.attributes[c].name,"href"==name||"data-request"==name)var d=encodeURIComponent(a.attributes[c].name.replace("data-",""))+"="+encodeURIComponent(a.attributes[c].value);else 0==name.indexOf("data-")&&b.push(encodeURIComponent(a.attributes[c].name.slice(5))+"="+encodeURIComponent(a.attributes[c].value));window.location="#!_tr&"+b.join("&")+"&"+d}},formObject:function(a){if(a&&"FORM"===a.nodeName){var b,c,d=Object();for(b=a.elements.length-1;b>=0;b-=1)if(""!==a.elements[b].name)switch(a.elements[b].nodeName){case"INPUT":switch(a.elements[b].type){case"checkbox":case"radio":a.elements[b].checked&&(d[a.elements[b].name]=a.elements[b].value);break;case"file":baldrick.fn.log("Browser does not support file uploads file API")}break;case"SELECT":switch(a.elements[b].type){case"select-one":d[a.elements[b].name]=a.elements[b].value;break;case"select-multiple":for(c=a.elements[b].options.length-1;c>=0;c-=1)a.elements[b].options[c].selected&&(d[a.elements[b].name][c]=a.elements[b].options[c].value)}break;default:d[a.elements[b].name]=a.elements[b].value}return d}},defaults:{},log:function(){}};var readyStateCheckInterval=setInterval(function(){"complete"===document.readyState&&(baldrick(bindClass),clearInterval(readyStateCheckInterval))},10);