/* BaldrickJS  V0.0.2 | (C) David Cramer & Rory McGuire - 2013 | MIT License */
var bindClass="trigger",actionQueued,requestURL=null,_cache={},baldrick=function(a){return new baldrick.fn.buildTriggers(a)};baldrick.fn=baldrick.prototype={buildTriggers:function(a){var b=!1;for(document.getElementsByClassName(a)&&(b=document.getElementsByClassName(a)),i=0;b.length>i;i++){b[i].delay=0;var d="FORM"==b[i].nodeName?"submit":"click";b[i].id||(b[i].id=baldrick.prototype.genid(b[i]));for(var e in b[i].attributes)if(b[i].attributes[e])switch(b[i].attributes[e].name){case"data-init":"function"==typeof window[b[i].attributes[e].value]&&window[b[i].attributes[e].value](b[i]),b[i].removeAttribute("data-init");break;case"data-delay":b[i].delay=b[i].attributes[e].value;break;case"data-autoload":case"data-preload":if("true"==b[i].attributes[e].value){b[i].removeAttribute("data-autoload"),"data-preload"==b[i].attributes[e].name&&(b[i].removeAttribute("data-preload"),_cache[b[i].id]={html:null});var f=b[i].getAttribute("data-delay")?b[i].getAttribute("data-delay"):0;setTimeout(function(){baldrick.fn.doAction(arguments[0])},f,b[i])}break;case"data-event":d=b[i].attributes[e].value;break;default:}b[i].addEventListener?b[i].addEventListener(d,baldrick.fn.queueEvent,!1):b[i].attachEvent&&b[i].attachEvent("on"+d,baldrick.fn.queueEvent)}window.addEventListener("hashchange",baldrick.fn.hashAction,!1)},queueEvent:function(a){var b=this;b.getAttribute("data-before")&&"function"==typeof window[b.getAttribute("data-before")]&&0==window[b.getAttribute("data-before")](a)||(a.preventDefault(),b.getAttribute("data-for")&&(b=document.getElementById(b.getAttribute("data-for"))?document.getElementById(b.getAttribute("data-for")):b),clearTimeout(actionQueued),actionQueued=setTimeout(function(){baldrick.fn.buildHash(b),baldrick.fn.doAction(b,a)},b.delay))},doAction:function(a,b){if(!a)return baldrick.fn.log("Invalid trigger element"),void 0;if(window.removeEventListener("hashchange",baldrick.fn.hashAction),a.getAttribute("data-clear")){var c=a.getAttribute("data-clear").split(";");c.forEach(function(a){document.getElementById(a)&&(document.getElementById(a).innerHTML="")})}var d=a.getAttribute("data-target")?document.getElementById(a.getAttribute("data-target")):null;d&&(d.xmlhttp?d.xmlhttp.abort():void 0!==_cache[a.id]&&_cache[a.id].xmlhttp&&(_cache[a.id].xmlhttp.abort(),console.log(_cache[a.id].xmlhttp)));var e={request:a.getAttribute("data-request")?a.getAttribute("data-request"):null,hrefaction:a.href?a.href:"FORM"==a.nodeName?a.getAttribute("action")?a.getAttribute("action"):requestURL:requestURL,callback:a.getAttribute("data-callback")?a.getAttribute("data-callback"):null,success:a.getAttribute("data-success")?a.getAttribute("data-success"):null,fail:a.getAttribute("data-fail")?a.getAttribute("data-fail"):null,activeClass:a.getAttribute("data-active-class")?a.getAttribute("data-active-class"):"active",method:a.getAttribute("data-method")?a.getAttribute("data-method"):"FORM"==a.nodeName?a.getAttribute("method")?a.getAttribute("method"):"POST":"POST",groups:document.getElementsByClassName(bindClass),target:d,progress:a.getAttribute("data-progress")?a.getAttribute("data-progress"):null};if(!a.getAttribute("data-start")||"function"!=typeof window[a.getAttribute("data-start")]||0!=window[a.getAttribute("data-start")](b)){if(e.groups){for(i=0;e.groups.length>i;i++)e.groups[i].getAttribute("data-group")===a.getAttribute("data-group")&&(e.groups[i].className=e.groups[i].className.replace(" "+e.activeClass,""));a.className=a.className+" "+e.activeClass}var f=a.value?a.value:!1;if(window.FileReader&&"POST"==e.method){var g="FORM"==a.nodeName?new FormData(a):new FormData;0!=f&&g.append("value",f)}else{var g="FORM"==a.nodeName?a:new FormData;0!=f&&(g.value=f)}for(var h in a.attributes)a.attributes[h]&&a.attributes[h].name&&"data-"==a.attributes[h].name.substr(0,5)&&(window.FileReader&&"POST"==e.method?g.append(a.attributes[h].name.substr(5),a.attributes[h].value):g[a.attributes[h].name.substr(5)]=a.attributes[h].value);if(d||e.callback||e.progress||baldrick.fn.log("Invalid target or no target defined. set either data-target or data-calback",a,b),(e.request||e.hrefaction)&&(d||"function"==typeof window[e.callback]||e.progress))try{baldrick.fn.doRequest(e,{element:a,success:function(b){"function"==typeof window[e.success]&&window[e.success](a,b),baldrick.fn.buildTriggers(bindClass)},fail:function(b){"function"==typeof window[e.fail]&&window[e.fail](a,b),baldrick.fn.buildTriggers(bindClass)},data:g})}catch(j){baldrick.fn.log(j)}else baldrick.fn.log("No request URL defined"),"function"==typeof window[e.callback]&&window[e.callback](a,b)}},doRequest:function(){var a,b=arguments[1].element,c=arguments[0].request?arguments[0].request:arguments[0].hrefaction,d=b.getAttribute("data-timeout")?b.getAttribute("data-timeout"):"30000",e=arguments[0].target,f=b.getAttribute("data-load-element")?document.getElementById(b.getAttribute("data-load-element")):e,g=arguments[0].progress;if(g&&"function"!=typeof window[g]&&document.getElementById(g)&&(g=document.getElementById(g)),f){var h=b.getAttribute("data-load-class")?b.getAttribute("data-load-class"):"loading",i=f.className.replace(" "+h,"");f.className=i+" "+h}var j=arguments[1].success,k=arguments[1].fail;if("function"==typeof window[arguments[0].callback])var l=arguments[0].callback,m=b.getAttribute("data-callback-type")?b.getAttribute("data-callback-type"):"html";if(void 0!==_cache[b.id]&&_cache[b.id].html){if(e&&(e.innerHTML=_cache[b.id].html,f.className=i),l){var n=document.createElement("script");n.setAttribute("type","text/javascript"),"html"==m||"HTML"==m?window[l](_cache[b.id].html):(n.text=l+"("+_cache[b.id].html+");",document.head.appendChild(n),document.head.removeChild(document.head.lastChild))}j(_cache[b.id]),_cache[b.id].html=null}if(serialize=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},c="GET"==arguments[0].method?c+"?"+serialize(arguments[1].data):c,window.XMLHttpRequest)a=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;a=new ActiveXObject("Microsoft.XMLHTTP")}if(void 0!==_cache[b.id]?_cache[b.id].xmlhttp=a:e&&(e.xmlhttp=a),d>0)var o=setTimeout(function(){d>0&&(a.abort(),baldrick.fn.log("Timeout ("+d+"ms)"))},d);a.onreadystatechange=function(){if(4==a.readyState&&200==a.status)if(clearTimeout(o),g&&("function"==typeof window[g]?window[g]({response:a.responseText,completed:100}):g.style.width="100%"),f&&(f.className=i),e&&void 0!==_cache[b.id])null==_cache[b.id].html?(_cache[b.id].html=a.responseText,delete _cache[b.id].xmlhttp):(e.innerHTML=a.responseText,delete e.xmlhttp);else{if(e&&(e.innerHTML=a.responseText,delete e.xmlhttp),l){var c=document.createElement("script");c.setAttribute("type","text/javascript"),"html"==m||"HTML"==m?window[l](a.responseText):JSON?window[l](JSON.parse(a.responseText)):(c.text=l+"("+a.responseText+");",document.head.appendChild(c),document.head.removeChild(document.head.lastChild))}j(a)}4==a.readyState&&307==a.status&&(clearTimeout(o),baldrick.fn.log("HTTP Status: 307"),document.location="./"),4==a.readyState&&200!=a.status&&307!=a.status&&(f&&(f.className=i),clearTimeout(o),a.status&&baldrick.fn.log("HTTP Status: "+a.status),e&&delete e.xmlhttp,k&&(k(a),baldrick.fn.log("Request failed")),g&&("function"==typeof window[g]?window[g]({response:a.responseText,completed:0}):g.style.width="0%"))},a.open(arguments[0].method,c,!0),("json"==m||"JSON"==m)&&a.setRequestHeader("Accept","application/json,text/javascript"),"POST"==arguments[0].method?window.FileReader?a.upload&&g&&(a.upload.onprogress=function(a){a.lengthComputable&&("function"==typeof window[g]?window[g]({loaded:a.loaded,total:a.totalSize,completed:100*(a.loaded/a.totalSize)}):g.style.width=100*(a.loaded/a.totalSize)+"%")}):a.setRequestHeader("Content-type","application/x-www-form-urlencoded"):("function"==typeof window[arguments[0].callback],a.open(arguments[0].method,c,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded")),arguments[1].data?(window.FileReader||(arguments[1].data=serialize(arguments[1].data)),a.send(arguments[1].data)):a.send()},hashAction:function(a){var b=window.location.hash.substring(2);""===b&&(document.location=document.location),element=document.getElementById(b),element&&baldrick.fn.doAction(element,a)},buildHash:function(a){a&&(window.location="#!"+a.id)},formObject:function(a){if(a&&"FORM"===a.nodeName){var b,c,d=Object();for(b=a.elements.length-1;b>=0;b-=1)if(""!==a.elements[b].name)switch(a.elements[b].nodeName){case"INPUT":switch(a.elements[b].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":case"TEXTAREA":d[a.elements[b].name]=a.elements[b].value;break;case"checkbox":case"radio":a.elements[b].checked&&(d[a.elements[b].name]=a.elements[b].value);break;case"file":baldrick.fn.log("Browser does not support file uploads file API")}break;case"SELECT":switch(a.elements[b].type){case"select-one":d[a.elements[b].name]=a.elements[b].value;break;case"select-multiple":for(c=a.elements[b].options.length-1;c>=0;c-=1)a.elements[b].options[c].selected&&(d[a.elements[b].name][c]=a.elements[b].options[c].value)}break;case"BUTTON":switch(a.elements[b].type){case"reset":case"submit":case"button":d[a.elements[b].name]=a.elements[b].value}}return d}},log:function(){},genid:function(a){for(var b=a.nodeName.toLowerCase(),c=0;a.attributes.length>c;c++)name=a.attributes[c].name,"href"==name?(b+="&",b+=a.attributes[c].name,b+="=",b+=a.attributes[c].value):0==name.indexOf("data-")&&(b+="&",b+=a.attributes[c].name.slice(5),b+="=",b+=a.attributes[c].value);return b}};var readyStateCheckInterval=setInterval(function(){"complete"===document.readyState&&(baldrick(bindClass),clearInterval(readyStateCheckInterval))},10);